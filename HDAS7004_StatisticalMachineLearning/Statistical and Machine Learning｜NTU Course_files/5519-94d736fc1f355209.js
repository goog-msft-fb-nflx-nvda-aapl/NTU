"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5519],{95249:function(e,t,n){n.d(t,{default:function(){return b}});var r=n(57437),o=n(18087),a=n(64042),s=n(7027),i=n(16463),l=n(86623),u=n(27776),c=n(27079),d=n(89565),p=n(62626),m=n(92670),g=n(57890),v=n(50591),f=n(31863);let h=()=>{let e=(0,c.NL)(),t=(0,p.jD)(),n=(0,i.useParams)(),r=(0,f.i)(n.locale),o=g.a.collections(r),a=g.a.collectionIds(r),s=t===m.h.collection?o:a;return(0,d.D)({mutationFn:async e=>(await v.Z.post("/v3/course-collections/112-1",{courseId:e.id})).data,onMutate:async e=>{let t=u.A.loading("".concat(e.name," 加入中 ..."));return{course:e,toastId:t}},onError:(e,t,n)=>{var r;if(e instanceof l.d7&&(null===(r=e.response)||void 0===r?void 0:r.data.code))return u.A.dismiss(null==n?void 0:n.toastId);u.A.error("加入課程失敗",{id:null==n?void 0:n.toastId})},onSuccess:(e,t,n)=>{u.A.success("".concat(null==n?void 0:n.course.name," 已加入我的收藏"),{id:null==n?void 0:n.toastId})},onSettled:async()=>{await e.invalidateQueries({queryKey:s})}})},A=()=>{let e=(0,c.NL)(),t=(0,p.jD)(),n=(0,i.useParams)(),{mutateAsync:r}=h(),o=(0,f.i)(n.locale),a=g.a.collections(o),s=g.a.collectionIds(o),A=t===m.h.collection,y=A?a:s;async function w(){await e.invalidateQueries({queryKey:y})}return(0,d.D)({mutationFn:async e=>(await v.Z.delete("/v3/course-collections/112-1",{params:{courseId:e.id}})).data,onMutate:async e=>{let t=u.A.loading("".concat(e.name," 正在從我的收藏移除中 ..."));return{course:e,toastId:t}},onError:(e,t,n)=>{var r;if(e instanceof l.d7&&(null===(r=e.response)||void 0===r?void 0:r.data.code))return u.A.dismiss(null==n?void 0:n.toastId);u.A.error("移除課程失敗",{id:null==n?void 0:n.toastId})},onSuccess:(e,t,n)=>{u.A.success("".concat(null==n?void 0:n.course.name," 已從我的收藏移除"),{id:null==n?void 0:n.toastId,duration:A?1e4:void 0,action:A?{label:"復原",onClick:async()=>{(null==n?void 0:n.course)&&await r(null==n?void 0:n.course)}}:void 0})},onSettled:()=>w()})};var y=n(17042),w=n(16349);function b(e){let{course:t,large:n=!1}=e,i=(0,o.useTranslations)("button.collection"),l=(0,p.tv)(),{data:u}=(0,y.a)(),{data:c}=(0,s.K)(),{mutate:d,isLoading:g}=h(),{mutate:v,isLoading:f}=A(),b=null==c?void 0:c.some(e=>{let{courseId:n}=e;return n===t.id});return(0,r.jsxs)("button",{title:i(b?"remove":"add"),disabled:g||f,onClick:e=>{if(!u)return l.push(m.h.login);g||f||(e.stopPropagation(),b?v(t):d(t))},className:(0,w.cn)("inline-flex items-center justify-center whitespace-nowrap rounded text-sm font-medium transition-colors focus-visible:bg-black/15 focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50",!n&&"rounded-full p-2.5 align-middle",n&&"h-8 gap-1.5 bg-black/5 pl-3 pr-3 hover:bg-black/10",b&&"text-error-main",n&&b&&"bg-error-main/10 hover:bg-error-main/15 focus-visible:bg-error-main/20"),children:[(0,r.jsx)(a.Z,{size:n?16:18,className:(0,w.cn)(b&&"fill-current")}),n?i(b?"remove":"add"):""]})}},94023:function(e,t,n){n.d(t,{default:function(){return S}});var r=n(57437),o=n(2265),a=n(18087),s=n(19047),i=n(76548),l=n(58767),u=n(16463),c=n(86623),d=n(27776),p=n(27079),m=n(89565),g=n(62626),v=n(57890),f=n(41017),h=n(50591),A=n(31863);let y=()=>{let e=(0,p.NL)(),t=(0,g.jD)(),n=(0,u.useParams)(),r=(0,A.i)(n.locale),o=v.a.preselects(r),a=v.a.preselectIds(r),s=t.split("/").at(1)===f.G7.Priority?o:a;return(0,m.D)({mutationFn:async e=>(await h.Z.post("/v3/course-tables/preselected",{semester:e.semester,serial:e.serial})).data,onMutate:async e=>{let t=d.A.loading("".concat(e.name," 加入中 ..."));return{course:e,toastId:t}},onError:(e,t,n)=>{var r;if(e instanceof c.d7&&(null===(r=e.response)||void 0===r?void 0:r.data.code))return d.A.dismiss(null==n?void 0:n.toastId);d.A.error("加入課程失敗",{id:null==n?void 0:n.toastId})},onSuccess:(e,t,n)=>{d.A.success("".concat(null==n?void 0:n.course.name," 已加入預選課表"),{id:null==n?void 0:n.toastId})},onSettled:async()=>{await e.invalidateQueries({queryKey:s})}})},w=()=>{let e=(0,p.NL)(),t=(0,g.jD)(),n=(0,u.useParams)(),{mutateAsync:r}=y(),o=(0,A.i)(n.locale),a=v.a.preselects(o),s=v.a.preselectIds(o),i=t.split("/").at(1)===f.G7.Priority,l=i?a:s;async function w(){await e.invalidateQueries({queryKey:l})}return(0,m.D)({mutationFn:async e=>(await h.Z.delete("/v3/course-tables/preselected",{params:{semester:e.semester,serial:e.serial}})).data,onMutate:async e=>{let t=d.A.loading("".concat(e.name," 正在從預選課表移除中 ..."));return{course:e,toastId:t}},onError:(e,t,n)=>{var r;if(e instanceof c.d7&&(null===(r=e.response)||void 0===r?void 0:r.data.code))return d.A.dismiss(null==n?void 0:n.toastId);d.A.error("移除課程失敗",{id:null==n?void 0:n.toastId})},onSuccess:(e,t,n)=>{d.A.success("".concat(null==n?void 0:n.course.name," 已從預選課表移除"),{id:null==n?void 0:n.toastId,duration:i?1e4:void 0,action:i?{label:"我後悔了",onClick:async()=>{(null==n?void 0:n.course)&&await r(null==n?void 0:n.course)}}:void 0})},onSettled:()=>w()})};var b=n(76191),C=n(17042),I=n(92670),P=n(84167);function S(e){let{course:t,large:n=!1}=e,u=(0,a.useTranslations)("button.preselect"),c=(0,g.tv)(),{data:d}=(0,C.a)(),{data:p}=(0,l.E)(),{data:{semester:m,progress:v}={}}=(0,b.S)(),{mutate:f,isLoading:h}=y(),{mutate:A,isLoading:S}=w(),L=null==p?void 0:p.preselectedCourses.some(e=>{let{semester:n,serial:r}=e;return n===t.semester&&r===t.serial}),k=null==p?void 0:p.assignedCourses.some(e=>{let{courseId:n}=e;return n===t.id}),T=(0,o.useMemo)(()=>t.semester!==m?u("not-current-semester"):(null==v?void 0:v.canAddCourse)?t.status===P.D4.Canceled?u("canceled"):void 0:u("not-add-period"),[v,m,t,u]);return(0,r.jsx)(s.Z,{placement:"left",title:null!=T?T:k&&u("assigned"),children:(0,r.jsx)("span",{children:(0,r.jsx)(i.Z,{variant:"ghost",disabled:h||S||!(null==v?void 0:v.canAddCourse)||!L&&!!T,sx:{color:k||L&&T?"text.main":L?"error.main":"primary.main"},onClick:e=>{if(!d)return c.push(I.h.login);h||S||(e.preventDefault(),e.stopPropagation(),L?A(t):f(t))},children:n?L?u("remove-long"):u("add-long"):L?u("remove"):u("add")})})})}},7027:function(e,t,n){n.d(t,{K:function(){return d}});var r=n(16463),o=n(59772),a=n(51864),s=n(17042),i=n(57890),l=n(84167),u=n(50591),c=n(31863);let d=function(){let{withCourse:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{withCourse:null},{data:t}=(0,s.a)(),n=(0,r.useParams)(),d=(0,c.i)(n.locale);return(0,a.a)({queryKey:e?i.a.collections(d):i.a.collectionIds(d),queryFn:async()=>{let t=await u.Z.get("/v3/course-collections/112-1",{params:{withCourse:e,lang:d}});return o.z.object({courseId:o.z.string(),course:l.T0.optional()}).array().parse(t.data.items)},enabled:!!t,retry:!1,staleTime:1/0})}},58767:function(e,t,n){n.d(t,{E:function(){return c}});var r=n(18087),o=n(51864),a=n(17042),s=n(57890),i=n(95930),l=n(50591),u=n(31863);let c=function(){let{withCourse:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{withCourse:null},{data:t}=(0,a.a)(),n=(0,r.useLocale)(),c=(0,u.i)(n);return(0,o.a)({queryKey:e?s.a.preselects(c):s.a.preselectIds(c),queryFn:async()=>{let t=await l.Z.get("/v3/course-tables/preselected",{params:{withCourse:e,lang:c}});return i.Le.parse(t.data)},enabled:!!t,staleTime:1/0})}},76191:function(e,t,n){n.d(t,{S:function(){return i}});var r=n(51864),o=n(57890),a=n(41017),s=n(50591);let i=()=>(0,r.a)({queryKey:o.a.progress,queryFn:async()=>{let e=await s.Z.get("/v3/config/progresses");return a._n.parse(e.data)},staleTime:864e5})},92670:function(e,t,n){n.d(t,{h:function(){return o}});var r=n(19725);let o={home:"/",login:"/login",logout:"/logout",news:e=>["/news",e].filter(Boolean).join("/"),help:"/help",collection:"/collection",search:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.Sc.quick;return"/search/".concat(e)},course:(e,t)=>"/courses/".concat(e,"/").concat(t),schedule:function(){let{link:e,phase:t,view:n,field:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return["/schedule",null!=e?e:t,null!=n?n:r&&"priority",r].filter(Boolean).join("/")},devLoginUrl:"".concat("https://course.ntu.edu.tw/api","/v1/auth/dev/login"),prodLoginUrl:"".concat("https://course.ntu.edu.tw/api","/v1/auth/sso/login"),devLogoutUrl:"".concat("https://course.ntu.edu.tw/api","/v1/auth/dev/logout"),prodLogoutUrl:"".concat("https://course.ntu.edu.tw/api","/v1/auth/sso/logout"),ntuHomePage:"https://www.ntu.edu.tw/",ntuAcaHomePage:"https://www.aca.ntu.edu.tw/",bachelorCourse:"https://reg.aca.ntu.edu.tw/GradeCheck/StudentGCForm",googleMap:e=>"https://www.google.com/maps/search/?api=1&query=".concat(e),specialHref:e=>"https://specom.aca.ntu.edu.tw/Domain/program?program=".concat(e),deptInstructPdf:e=>"https://nol.ntu.edu.tw/nol/note/113-1/".concat(e,".pdf"),practiceGroup:"https://nol.ntu.edu.tw/nol/coursesearch/print_cougrp.php",taicaHref:"https://www.aca.ntu.edu.tw/w/aca/CDService_24082913533894186"}},19725:function(e,t,n){var r,o,a,s,i,l,u,c,d,p,m,g;n.d(t,{NJ:function(){return A},Pp:function(){return v},SQ:function(){return h},Sc:function(){return r},bB:function(){return l},hd:function(){return f},uu:function(){return o},vZ:function(){return a},xz:function(){return i},yy:function(){return s}}),(u=r||(r={})).quick="quick",u.dept="dept",u.general="general",u.common="common",u.pearmy="pearmy",u.program="program",u.expertise="expertise",u.interschool="interschool",u.grouping="course-groups",u.english="english",(c=o||(o={})).keyword="k",c.semester="s",c.isFullYear="fy",c.time="t",c.timeStrictMatch="tsm",c.enrollMethods="em",c.otherLimits="ol",c.excludedKeywords="ek",c.isPrecise="ip",c.department="d",c.suggestedGrade="sg",c.isCompulsory="ic",c.generalCourseTypes="gct",c.commonCourseTypes="cct",c.peArmyCourseTypes="pact",c.courseProviders="cp",c.groupingCourseTypes="gpct",(d=a||(a={})).A1="A1",d.A2="A2",d.A3="A3",d.A4="A4",d.A5="A5",d.A6="A6",d.A7="A7",d.A8="A8",d.BasicAbility="B",d.Freshman="E";let v={A1:"A1",A2:"A2",A3:"A3",A4:"A4",A5:"A5",A6:"A6",A7:"A7",A8:"A8",B:"BasicAbility",E:"Freshman"};(p=s||(s={})).chinese="1",p.english="2",p.foreignLanguage="3",p.canBeForeignLanguage="4",p.commonSelective="5";let f={1:"chinese",2:"english",3:"foreignLanguage",4:"canBeForeignLanguage",5:"commonSelective"};(m=i||(i={})).health="1",m.specialSport="2",m.electivePE="3",m.schoolTeamPE="4",m.army="5";let h={1:"health",2:"specialSport",3:"electivePE",4:"schoolTeamPE",5:"army"};(g=l||(l={})).NTNU="ntnu",g.NTUST="ntust";let A={ntnu:"NTNU",ntust:"NTUST"}},41017:function(e,t,n){n.d(t,{G7:function(){return l},_n:function(){return v},bW:function(){return u},g8:function(){return m},nz:function(){return i},qb:function(){return c}});var r,o,a,s,i,l,u,c,d=n(59772);(r=i||(i={})).PreReg1="prereg1",r.PreReg2="prereg2",r.AddDrop1="adddrop1",r.AddDrop2="adddrop2",r.AddDrop3="adddrop3",r.AddDrop4="adddrop4",r.AddDrop5="adddrop5",r.AddDrop6="adddrop6",r.Final="final";let p={...i},m=Object.fromEntries(Object.entries(i).map(e=>{let[t,n]=e;return[n,t]}));(o=l||(l={})).Priority="priority",o.Result="result",(a=u||(u={})).List="list",a.Table="table",(s=c||(c={})).Preselecting="Preselecting",s.Started="Started",s.Waiting="Waiting",s.Ended="Ended";let g=d.z.object({canAddCourse:d.z.boolean(),endAt:d.z.string(),link:d.z.string(),phase:d.z.enum(Object.keys(i)),status:d.z.nativeEnum(c),startAt:d.z.string()}),v=d.z.object({progress:g.nullable(),progresses:g.array(),semester:d.z.string(),semesterList:d.z.string().array()}).transform(e=>{var t;return{progress:e.progress,progresses:e.progresses,semester:e.semester,semesterList:e.semesterList.sort((e,t)=>e.localeCompare(t,void 0,{numeric:!0})).reverse().map(e=>({semester:e,year:parseInt(e.split("-")[0]),term:parseInt(e.split("-")[1])})),current:(null===(t=e.progress)||void 0===t?void 0:t.phase)?p[e.progress.phase]:null}})},16349:function(e,t,n){n.d(t,{cn:function(){return a}});var r=n(44839),o=n(96164);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)((0,r.W)(t))}}}]);